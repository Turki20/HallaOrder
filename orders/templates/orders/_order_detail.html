{# templates/orders/_order_detail.html #}
<div class="p-4" dir="rtl">
  <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
    <div>
      <div class="small text-muted">رقم الطلب</div>
      <div class="fw-semibold">#{{ order.pk }}</div>
    </div>
    <div>
      <div class="small text-muted">الحالة</div>
      <span class="badge bg-secondary">{{ order.get_status_display|default:order.status }}</span>
    </div>
    <div>
      <div class="small text-muted">وقت الإنشاء</div>
      <div class="fw-semibold">{{ order.created_at|date:"Y-m-d H:i" }}</div>
    </div>
    <div>
      <div class="small text-muted">طريقة الدفع</div>
      <div class="fw-semibold">
        {% if order.payment_method == "Cash" %}نقدًا{% else %}أونلاين{% endif %}
      </div>
    </div>
  </div>

  <hr class="my-3">

  <div class="row g-3">
    <div class="col-12 col-md-6">
      <div class="border rounded p-3 h-100">
        <div class="fw-semibold mb-2">العميل</div>
        <div class="small">
          {% if order.customer %}
            <div><i class="bi bi-person me-1"></i> {{ order.customer.username|default:"عميل" }}</div>
            {% if order.customer.email %}<div class="text-muted">{{ order.customer.email }}</div>{% endif %}
          {% else %}
            <div class="text-muted">—</div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6">
      <div class="border rounded p-3 h-100">
        <div class="fw-semibold mb-2">الفرع</div>
        <div class="small">
          <div><i class="bi bi-shop me-1"></i> {{ order.branch.name }}</div>
          {% if order.branch.address %}<div class="text-muted">{{ order.branch.address }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3 border rounded">
    <div class="p-3 fw-semibold">العناصر</div>
    <div class="table-responsive">
      <table class="table table-sm align-middle m-0">
        <thead class="table-light">
          <tr>
            <th>المنتج</th>
            <th class="text-center">الكمية</th>
            <th>الخيارات</th>
            <th>الإضافات</th>
            <th class="text-end">السعر</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order.items.all %}
            <tr>
              <td class="fw-medium">
                {% if item.product and item.product.image %}
                  <img src="{{ item.product.image.url }}" alt="" style="width:28px;height:28px;border-radius:.4rem;object-fit:cover;" class="ms-2">
                {% endif %}
                {{ item.product.name|default:"منتج" }}
              </td>
              <td class="text-center">{{ item.quantity }}</td>
              <td class="small text-muted">{{ item.options|default:"—" }}</td>
              <td class="small text-muted">{{ item.addons|default:"—" }}</td>
              <td class="text-end">
                {% if item.product and item.product.price %}
                  ر.س {{ item.product.price|floatformat:2 }}
                {% else %} — {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-center text-muted py-4">لا توجد عناصر</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="d-flex justify-content-end mt-3">
    <div class="fs-6">
      <span class="text-muted">الإجمالي:</span>
      <span class="fw-bold" style="color:#0f5d61;">ر.س {{ order.total_price|floatformat:2 }}</span>
    </div>
  </div>
</div>
